!function(t,e){function i(e,i){this.element=e,this.options=t.extend({},n,i),this._defaults=n,this._id=t(this.element).attr("id"),this._name=a,this._selectedData=new Array(3),this.init()}var a="cityDropdown",n={propertyName:"'value"};i.prototype={init:function(){var e=this;t(this.element).click(function(){t(".dropdown-menu").parent().removeClass("open"),e.initCityData()})},getFinalCode:function(t){var e=0;return t[2]?e=t[2]:t[1]?e=t[1]:t[0]&&(e=t[0]),e},dataFromCode:function(t,e){var i=this._cityData.PROVINCE_AREA,a=this._cityData.CITY_AREA,n=this._cityData.TOWN_AREA;n[e]&&(t[2]=e,this.dataFromCode(t,n[e].parent)),a[e]&&(t[1]=e,this.dataFromCode(t,a[e].parent)),i[e]&&(t[0]=e)},getText:function(t){var e="",i=this._cityData.PROVINCE_AREA,a=this._cityData.CITY_AREA,n=this._cityData.TOWN_AREA;return t[0]&&(e+=i[t[0]].name),t[1]&&(e+="-"+a[t[1]].name),t[2]&&(e+="-"+n[t[2]].name),e},hotCitysHtml:function(t){var e=this._cityData.CUSTOM_AREA,i=this._cityData.CITY_AREA,a="";return _.each(e,function(e){var n="";t==e&&(n='class="active"'),a+="<a "+n+' title="'+e+'">'+i[e].name+"</a>"}),a},provinceHtml:function(t){var e=this._cityData.PROVINCE_AREA,i="";return _.each(e,function(e,a){var n="";t==a&&(n='class="active"'),i+="<a "+n+" title="+a+">"+e.name+"</a>"}),i},cityHtml:function(t,e){var i=this._cityData.PROVINCE_AREA,a=this._cityData.CITY_AREA,n="";if(t){var s=i[t].child;_.each(s,function(t){var i="";e==t&&(i='class="active"');var s=a[t];n+="<a "+i+' title="'+t+'">'+s.name+"</a>"})}return n},townHtml:function(t,e){var i=this._cityData.CITY_AREA,a=this._cityData.TOWN_AREA,n="";if(t){var s=i[t].child;_.each(s,function(t){var i="";e==t&&(i='class="active"');var s=a[t];s&&(n+="<a "+i+' title="'+t+'">'+s.name+"</a>")})}return n},dropdownHtml:function(){var t="";return t+='<div id="'+this._id+'-dropdown" class="dropdown-menu dropdown-city">',t+='<div class="dropdown-panel">',t+='<ul id="'+this._id+'-cityNavTabs" class="nav nav-tabs nav-justified">',t+='<li class="active">',t+='<a href="#'+this._id+'-hotCitysTab" data-toggle="tab" aria-expanded="true">常用</a>',t+="</li>",t+="<li>",t+='<a href="#'+this._id+'-provinceTab" data-toggle="tab" aria-expanded="false">省</a>',t+="</li>",t+="<li>",t+='<a href="#'+this._id+'-cityTab" data-toggle="tab" aria-expanded="false">市</a>',t+="</li>",t+="<li>",t+='<a href="#'+this._id+'-townTab" data-toggle="tab" aria-expanded="false">区县</a>',t+="</li>",t+="</ul>",t+='<div class="tab-content">',t+='<div class="tab-pane fade active in" id="'+this._id+'-hotCitysTab">',t+='<div class="clearfix">',t+=this.hotCitysHtml(this._selectedData[1]),t+="</div>",t+='<div class="tab-bottom"></div>',t+="</div>",t+='<div class="tab-pane fade" id="'+this._id+'-provinceTab">',t+='<div class="clearfix">',t+=this.provinceHtml(this._selectedData[0],this._selectedData[1]),t+="</div>",t+='<div class="tab-bottom"></div>',t+="</div>",t+='<div class="tab-pane fade" id="'+this._id+'-cityTab">',t+='<div class="clearfix"></div>',t+='<div class="tab-bottom"></div>',t+="</div>",t+='<div class="tab-pane fade" id="'+this._id+'-townTab">',t+='<div class="clearfix"></div>',t+='<div class="tab-bottom"></div>',t+="</div>",t+="</div>",t+="</div>",t+="</div>"},selectProvince:function(e){var i=e.target,a=t(this.element).next(".dropdown-city");if("A"===i.tagName){var n=t(i).attr("title"),s=this.cityHtml(n);this._selectedData[0]=n,this._selectedData[1]="",this._selectedData[2]="",a.find("#"+this._id+"-cityTab .clearfix").html(s),a.find("#"+this._id+'-cityNavTabs a[href="#'+this._id+'-cityTab"]').tab("show"),t(this.element).val(this.getText(this._selectedData)),t(this.element).trigger("keyup"),t(this.element).data("value",this.getFinalCode(this._selectedData))}},provinceEvent:function(){var e=this,i=t(e.element).next(".dropdown-city").find("#"+e._id+"-provinceTab");i.find(".clearfix").on("click","a",function(t){t.preventDefault(),e.selectProvince(t)})},selectCity:function(e){var i=e.target,a=t(this.element).next(".dropdown-city"),n=this._cityData.CITY_AREA;if("A"===i.tagName){var s=t(i).attr("title"),d=this.townHtml(s);this._selectedData[0]=n[s].parent,this._selectedData[1]=s,this._selectedData[2]="",a.find("#"+this._id+"-townTab .clearfix").html(d),a.find("#"+this._id+'-cityNavTabs a[href="#'+this._id+'-townTab"]').tab("show"),t(this.element).val(this.getText(this._selectedData)),t(this.element).trigger("keyup"),t(this.element).data("value",this.getFinalCode(this._selectedData))}},cityEvent:function(){var e=this,i=t(e.element).next(".dropdown-city").find("#"+e._id+"-cityTab");i.find(".clearfix").on("click","a",function(t){t.preventDefault(),e.selectCity(t)})},selectTown:function(e){var i=e.target,a=t(this.element).next(".dropdown-city");if("A"===i.tagName){var n=t(i).attr("title");this._selectedData[2]=n,t(this.element).val(this.getText(this._selectedData)),t(this.element).trigger("keyup"),t(this.element).data("value",this.getFinalCode(this._selectedData)),a.parent().removeClass("open")}},townEvent:function(){var e=this,i=t(e.element).next(".dropdown-city").find("#"+e._id+"-townTab");i.find(".clearfix").on("click","a",function(t){t.preventDefault(),e.selectTown(t)})},hotCitysEvent:function(){var e=this,i=t(e.element).next(".dropdown-city").find("#"+e._id+"-hotCitysTab");i.find(".clearfix").on("click","a",function(t){t.preventDefault(),e.selectCity(t)})},initCityData:function(){var i=this;e.__citydata__?i.renderFunction(e.__citydata__):t.ajax({url:e.__profix__+"area/js/list.json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t&&0===t.code?(e.__citydata__=t.data,i.renderFunction(e.__citydata__)):alert("系统错误！")}).fail(function(){alert("系统错误！")})},initTabEvent:function(){var e=this,i="#"+e._id+"-",a=t(e.element).next(".dropdown-city");t("#"+e._id+'-cityNavTabs a[data-toggle="tab"]').on("shown.bs.tab",function(n){var s=n.target,d=t(s).attr("href");d===i+"hotCitysTab"?a.find(i+"hotCitysTab .clearfix").html(e.hotCitysHtml(e._selectedData[1])):d===i+"provinceTab"?a.find(i+"provinceTab .clearfix").html(e.provinceHtml(e._selectedData[0])):d===i+"cityTab"?a.find(i+"cityTab .clearfix").html(e.cityHtml(e._selectedData[0],e._selectedData[1])):d===i+"townTab"&&a.find(i+"townTab .clearfix").html(e.townHtml(e._selectedData[1],e._selectedData[2]))})},insertElement:function(){var e=this,i=t(e.element),a="#"+this._id+"-dropdown";t(e.dropdownHtml()).insertAfter(e.element).promise().done(function(){i.dropdown(),e.hotCitysEvent(),e.provinceEvent(),e.cityEvent(),e.townEvent(),e.initTabEvent(),t(a).parent().addClass("open"),i.focus()})},renderFunction:function(e){var i=this,a=t(i.element);i._cityData=e,i.dataFromCode(i._selectedData,a.data("value"));var n="#"+this._id+"-dropdown";0===a.parent().has(n).length?i.insertElement():t.when(t(n).remove()).then(i.insertElement())}},t.fn[a]=function(e){return this.each(function(){t.data(this,"plugin_"+a)||t.data(this,"plugin_"+a,new i(this,e))})}}(jQuery,window,document);