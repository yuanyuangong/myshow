!function(t,e){function a(e,a){this.element=e,this.options=t.extend({},n,a),this._defaults=n,this._id=t(this.element).attr("id"),this._name=i,this._selectedData=new Array(2),this.init()}var i="portDropdown",n={propertyName:"'value"};a.prototype={init:function(){var e=this;t(this.element).click(function(){t(".dropdown-menu").parent().removeClass("open"),e.initPortData()})},getFinalCode:function(t){var e=0;return t[1]?e=t[1]:t[0]&&(e=t[0]),e},dataFromCode:function(t,e){var a=this._portData.PORT_AREA,i=this._portData.PORT;i[e]&&(t[1]=e,this.dataFromCode(t,i[e].parent)),a[e]&&(t[0]=e)},getText:function(t){var e="",a=this._portData.PORT_AREA,i=this._portData.PORT;return t[0]&&(e+=a[t[0]].name),t[1]&&(e+="-"+i[t[1]].name),e},hotPortsHtml:function(t){var e=this._portData.CUSTOM_AREA,a=this._portData.PORT,i="";return _.each(e,function(e){var n="";t==e&&(n='class="active"'),i+="<a "+n+' title="'+e+'">'+a[e].name+"</a>"}),i},provinceHtml:function(t){var e=this._portData.PORT_AREA,a="";return _.each(e,function(e,i){var n="";t==i&&(n='class="active"'),a+="<a "+n+' title="'+i+'">'+e.name+"</a>"}),a},portHtml:function(t,e){var a=this._portData.PORT_AREA,i=this._portData.PORT,n="";if(t){var o=a[t].child;_.each(o,function(t){var a="";e==t&&(a='class="active"');var o=i[t];n+="<a "+a+' title="'+t+'">'+o.name+"</a>"})}return n},dropdownHtml:function(){var t="";return t+='<div id="'+this._id+'-dropdown" class="dropdown-menu dropdown-port">',t+='<div class="dropdown-title">',t+="相关口岸",t+="</div>",t+='<div class="dropdown-panel">',t+='<ul id="'+this._id+'-portNavTabs" class="nav nav-tabs">',t+='<li class="active">',t+='<a href="#'+this._id+'-hotPortsTab" data-toggle="tab" aria-expanded="true">热门港口</a>',t+="</li>",t+="<li>",t+='<a href="#'+this._id+'-provinceTab" data-toggle="tab" aria-expanded="false">省份</a>',t+="</li>",t+="<li>",t+='<a href="#'+this._id+'-portTab" data-toggle="tab" aria-expanded="false">港口</a>',t+="</li>",t+="</ul>",t+='<div class="tab-content">',t+='<div class="tab-pane fade active in" id="'+this._id+'-hotPortsTab">',t+='<div class="clearfix">',t+=this.hotPortsHtml(this._selectedData[1]),t+="</div>",t+='<div class="tab-bottom"></div>',t+="</div>",t+='<div class="tab-pane fade" id="'+this._id+'-provinceTab">',t+='<div class="clearfix">',t+=this.provinceHtml(this._selectedData[0],this._selectedData[1]),t+="</div>",t+='<div class="tab-bottom"></div>',t+="</div>",t+='<div class="tab-pane fade" id="'+this._id+'-portTab">',t+='<div class="clearfix"></div>',t+='<div class="tab-bottom"></div>',t+="</div>",t+="</div>",t+="</div>",t+="</div>"},selectProvince:function(e){var a=e.target,i=t(this.element).next(".dropdown-port");if("A"===a.tagName){var n=t(a).attr("title"),o=this.portHtml(n);this._selectedData[0]=n,this._selectedData[1]="",i.find("#"+this._id+"-portTab .clearfix").html(o),i.find("#"+this._id+'-portNavTabs a[href="#'+this._id+'-portTab"]').tab("show"),t(this.element).val(this.getText(this._selectedData));var r=this.getFinalCode(this._selectedData);t(this.element).data("value",r),t(this.element).attr("data-value",r),t(this.element).trigger("keyup")}},provinceEvent:function(){var e=t(this.element).next(".dropdown-port").find("#"+this._id+"-provinceTab"),a=this;e.find(".clearfix").on("click","a",function(t){t.preventDefault(),a.selectProvince(t)})},selectPort:function(e){var a=e.target,i=t(this.element).next(".dropdown-port"),n=this._portData.PORT;if("A"===a.tagName){var o=t(a).attr("title");this._selectedData[0]=n[o].parent,this._selectedData[1]=o,t(this.element).val(this.getText(this._selectedData));var r=this.getFinalCode(this._selectedData);t(this.element).data("value",r),t(this.element).attr("data-value",r),i.parent().removeClass("open"),t(this.element).trigger("keyup")}},portEvent:function(){var e=t(this.element).next(".dropdown-port").find("#"+this._id+"-portTab"),a=this;e.find(".clearfix").on("click","a",function(t){t.preventDefault(),a.selectPort(t)})},hotPortsEvent:function(){var e=t(this.element).next(".dropdown-port").find("#"+this._id+"-hotPortsTab"),a=this;e.find(".clearfix").on("click","a",function(t){t.preventDefault(),a.selectPort(t)})},initPortData:function(){var a=this;e.__portdata__?a.renderFunction(e.__portdata__):t.ajax({url:e.__profix__+"port/js/list.json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){t&&0===t.code?(e.__portdata__=t.data,a.renderFunction(e.__portdata__)):alert("系统错误！")}).fail(function(){alert("系统错误！")})},initTabEvent:function(){var e=this,a="#"+e._id+"-",i=t(e.element).next(".dropdown-port");t("#"+e._id+'-portNavTabs a[data-toggle="tab"]').on("shown.bs.tab",function(n){var o=n.target,r=t(o).attr("href");r===a+"hotPortsTab"?i.find(a+"hotPortsTab .clearfix").html(e.hotPortsHtml(e._selectedData[1])):r===a+"provinceTab"?i.find(a+"provinceTab .clearfix").html(e.provinceHtml(e._selectedData[0])):r===a+"portTab"&&i.find(a+"portTab .clearfix").html(e.portHtml(e._selectedData[0],e._selectedData[1]))})},insertElement:function(){var e=this,a=t(e.element),i="#"+this._id+"-dropdown";t(e.dropdownHtml()).insertAfter(e.element).promise().done(function(){a.dropdown(),e.hotPortsEvent(),e.provinceEvent(),e.portEvent(),e.initTabEvent(),t(i).parent().addClass("open"),a.focus()})},renderFunction:function(e){var a=this,i=t(a.element);a._portData=e,a.dataFromCode(a._selectedData,i.data("value"));var n="#"+this._id+"-dropdown";0===i.parent().has(n).length?a.insertElement():t.when(t(n).remove()).then(a.insertElement())}},t.fn[i]=function(e){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new a(this,e))})}}(jQuery,window,document);