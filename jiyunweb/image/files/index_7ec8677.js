$(document).ready(function(){function t(t,a){var e=$("#"+t+"Template").html();Mustache.parse(e);var o=Mustache.render(e,a);return o}function a(a){$.ajax({url:window.__profix__+"task/publish.json",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(a)}).done(function(a){if(a)if(0===a.code){var e=BootstrapDialog.show({message:t("tpSucess"),closable:!1,nl2br:!1,cssClass:"publish-dialog",onshow:function(t){$.fn.centerModal(t.getModal(),330)},buttons:[{label:"确定",cssClass:"btn-success",action:function(t){t.close(),$(location).attr("href","/usercenter/buyer/publish_task.html")}}]});e.getModalHeader().hide()}else if(3===a.code){var e=BootstrapDialog.show({message:t("tpNoaudited"),closable:!1,nl2br:!1,cssClass:"publish-dialog",onshow:function(t){$.fn.centerModal(t.getModal(),330)},buttons:[{label:"确定",cssClass:"btn-success",action:function(t){t.close();var a=$("#userTypeInput").val();a?$(location).attr("href","/usercenter/buyer/company_info.html"):$(location).attr("href","/login.html")}}]});e.getModalHeader().hide()}else if(4===a.code){var e=BootstrapDialog.show({message:'<p class="msg">用户未登录，请登录后操作！</p>',closable:!1,nl2br:!1,cssClass:"msg-dialog",onshow:function(t){$.fn.centerModal(t.getModal(),110)},buttons:[{label:"确定",cssClass:"btn-success",action:function(t){t.close(),$(location).attr("href","/login.html")}}]});e.getModalHeader().hide()}}).fail(function(){$.fn.alert("系统错误！")})}function e(){$("#taskForm").on("click","#upNum",function(t){t.preventDefault();var a="#boxNum"+$(this).data("value"),e=$(a).val(),o=0;if($.isNumeric(e)){var r=parseInt(e,10);r>=0&&(o=r+1)}return $(a).val(o),!1}),$("#taskForm").on("click","#downNum",function(t){t.preventDefault();var a="#boxNum"+$(this).data("value"),e=$(a).val(),o=0;if($.isNumeric(e)){var r=parseInt(e,10);r>0&&(o=r-1)}return $(a).val(o),!1}),$("#taskForm").on("click","#taskPublishBtn",function(t){t.preventDefault();var e=$("#taskForm");if(e.find("input, textarea").each(function(){$(this).val(jQuery.trim($(this).val()))}),e.valid()){var o=e.serializeJSON(),r={};e.find("input[name='boxNum']").each(function(){r[$(this).data("value")]=$(this).val()}),o.port=$("#portDropdownInput").data("value"),o.backPort=$("#backPortDropdownInput").data("value"),o.packagePlace=$("#packagePlaceCityDropdownInput").data("value"),o.boxNumMap=r,a(o)}return!1}),$("#dockInput").on("input",function(){$("#backDockInput").val($(this).val())}),$("#portDropdownInput").on("keyup",function(){$("#backPortDropdownInput").val($(this).val()),$("#backPortDropdownInput").data("value",$(this).data("value")),$("#backPortDropdownInput").attr("data-value",$(this).attr("data-value"))})}function o(t){return"/trailer/port/"+t+"/index-1.html"}function r(){var t=$("#portSearchForm");if(t.find("input").each(function(){$(this).val(jQuery.trim($(this).val()))}),t.valid()){var a=$("#portCodeInput").data("value"),e=o(a);t.attr("action",e),t.submit()}}function n(){$("#taskForm").validate({rules:{port:{required:!0},dock:{required:!0},packagePlace:{required:!0},packageTimeStr:{required:!0},weight:{required:!0,regex:"^\\d+(.\\d{1,4})?$"}},messages:{port:{required:"提柜港不能为空"},dock:{required:"提柜港区/码头不能为空"},packagePlace:{required:"装卸地不能为空"},packageTimeStr:{required:"装卸时间不能为空"},weight:{required:"货物重量不能为空",regex:"货物重量不合法"}},tooltip_options:{port:{placement:"top"},dock:{placement:"top"},packagePlace:{placement:"top"},packageTimeStr:{placement:"top"},weight:{placement:"top"}}}),$("#portSearchForm").validate({rules:{portCode:{required:!0}},messages:{portCode:{required:"港口不能为空"}},tooltip_options:{portCode:{placement:"top"}}})}function i(){e(),$("#portDropdownInput").portDropdown(),$("#backPortDropdownInput").portDropdown(),$("#packagePlaceCityDropdownInput").cityDropdown(),$("#taskForm").find("#packageTimeInput").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",todayBtn:!0,autoclose:!0,todayHighlight:!0,startDate:new Date}),$("#portCodeInput").portDropdown(),$("#portSearchForm").on("click","#portSearchBtn",function(t){return t.preventDefault(),r(),!1})}i(),n()});